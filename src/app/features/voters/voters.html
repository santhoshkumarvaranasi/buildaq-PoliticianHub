<div class="page-container">
  <div class="page-header">
    <div>
      <h1>Constituency & Voter Database</h1>
      <p class="subtitle">Comprehensive voter records with family mapping and intelligence tagging</p>
    </div>
    <div class="header-actions">
      <button mat-stroked-button (click)="exportData()">
        <mat-icon>download</mat-icon>
        Export
      </button>
      <button mat-raised-button color="primary" (click)="importVoters()">
        <mat-icon>upload</mat-icon>
        Import EPIC Data
      </button>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <mat-card class="stat-card">
      <div class="stat-label">Total Voters</div>
      <div class="stat-value">{{ stats.totalVoters | number }}</div>
    </mat-card>
    <mat-card class="stat-card">
      <div class="stat-label">Families</div>
      <div class="stat-value">{{ stats.families | number }}</div>
    </mat-card>
    <mat-card class="stat-card">
      <div class="stat-label">Booths</div>
      <div class="stat-value">{{ stats.booths }}</div>
    </mat-card>
    <mat-card class="stat-card">
      <div class="stat-label">Wards</div>
      <div class="stat-value">{{ stats.wards }}</div>
    </mat-card>
    <mat-card class="stat-card tagged">
      <div class="stat-label">Tagged & Profiled</div>
      <div class="stat-value">{{ stats.tagged }}%</div>
    </mat-card>
  </div>

  <!-- Quick Segments -->
  <div class="segments-grid">
    <mat-card class="segment-card">
      <mat-icon>elderly</mat-icon>
      <div class="segment-value">{{ stats.seniorCitizens | number }}</div>
      <div class="segment-label">Senior Citizens</div>
    </mat-card>
    <mat-card class="segment-card">
      <mat-icon>badge</mat-icon>
      <div class="segment-value">{{ stats.govtStaff }}</div>
      <div class="segment-label">Govt Staff</div>
    </mat-card>
    <mat-card class="segment-card">
      <mat-icon>how_to_vote</mat-icon>
      <div class="segment-value">{{ stats.firstTimeVoters | number }}</div>
      <div class="segment-label">First Time Voters</div>
    </mat-card>
  </div>

  <!-- Analytics Dashboard -->
  <div class="analytics-section">
    <h3 class="section-title">Voter Demographics & Insights</h3>
    <div class="analytics-grid">
      <mat-card class="analytics-card">
        <h4>Age Distribution</h4>
        <div class="chart-placeholder">
          <div class="bar-chart">
            <div class="bar" style="height: 60%"><span>18-25 (25%)</span></div>
            <div class="bar" style="height: 80%"><span>26-40 (35%)</span></div>
            <div class="bar" style="height: 50%"><span>41-60 (22%)</span></div>
            <div class="bar" style="height: 40%"><span>60+ (18%)</span></div>
          </div>
        </div>
      </mat-card>

      <mat-card class="analytics-card">
        <h4>Gender Ratio</h4>
        <div class="chart-placeholder">
          <div class="pie-chart">
            <div class="pie-segment male">
              <strong>52%</strong>
              <span>Male (21,934)</span>
            </div>
            <div class="pie-segment female">
              <strong>48%</strong>
              <span>Female (20,246)</span>
            </div>
          </div>
        </div>
      </mat-card>

      <mat-card class="analytics-card">
        <h4>Booth Coverage</h4>
        <div class="chart-placeholder">
          <div class="progress-list">
            <div class="progress-item">
              <span>Visited (68%)</span>
              <mat-progress-bar mode="determinate" [value]="68" color="primary"></mat-progress-bar>
            </div>
            <div class="progress-item">
              <span>Contacted (52%)</span>
              <mat-progress-bar mode="determinate" [value]="52" color="accent"></mat-progress-bar>
            </div>
            <div class="progress-item">
              <span>Profiled (72%)</span>
              <mat-progress-bar mode="determinate" [value]="72" color="primary"></mat-progress-bar>
            </div>
          </div>
        </div>
      </mat-card>

      <mat-card class="analytics-card">
        <h4>Sentiment Analysis</h4>
        <div class="chart-placeholder">
          <div class="sentiment-bars">
            <div class="sentiment-row positive">
              <span>Positive</span>
              <div class="sentiment-bar" style="width: 62%">62%</div>
            </div>
            <div class="sentiment-row neutral">
              <span>Neutral</span>
              <div class="sentiment-bar" style="width: 28%">28%</div>
            </div>
            <div class="sentiment-row negative">
              <span>Negative</span>
              <div class="sentiment-bar" style="width: 10%">10%</div>
            </div>
          </div>
        </div>
      </mat-card>
    </div>
  </div>

  <!-- View Toggle -->
  <mat-card class="view-toggle-card">
    <mat-button-toggle-group [(value)]="viewMode">
      <mat-button-toggle value="voters">
        <mat-icon>person</mat-icon>
        Individual Voters
      </mat-button-toggle>
      <mat-button-toggle value="families">
        <mat-icon>family_restroom</mat-icon>
        Family View
      </mat-button-toggle>
      <mat-button-toggle value="analytics">
        <mat-icon>analytics</mat-icon>
        Analytics View
      </mat-button-toggle>
    </mat-button-toggle-group>
  </mat-card>

  <!-- Filters -->
  <mat-card class="filters-card">
    <div class="filters-row">
      <mat-form-field appearance="outline">
        <mat-label>Search</mat-label>
        <input matInput [(ngModel)]="searchTerm" (ngModelChange)="applyFilters()" placeholder="Name, EPIC ID...">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Ward</mat-label>
        <mat-select [(value)]="filterWard" (selectionChange)="applyFilters()">
          <mat-option value="all">All Wards</mat-option>
          <mat-option *ngFor="let i of [5,8,12,18,22]" [value]="i.toString()">Ward {{ i }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Booth</mat-label>
        <mat-select [(value)]="filterBooth" (selectionChange)="applyFilters()">
          <mat-option value="all">All Booths</mat-option>
          <mat-option *ngFor="let booth of [18,28,45,102,156]" [value]="booth.toString()">Booth {{ booth }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Tags</mat-label>
        <mat-select [(value)]="filterTag" (selectionChange)="applyFilters()">
          <mat-option value="all">All Tags</mat-option>
          <mat-option value="Senior Citizen">Senior Citizen</mat-option>
          <mat-option value="Government Staff">Government Staff</mat-option>
          <mat-option value="First Time Voter">First Time Voter</mat-option>
          <mat-option value="Influencer">Influencer</mat-option>
          <mat-option value="Student">Student</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </mat-card>

  <!-- Voters Table -->
  <mat-card class="table-card" *ngIf="viewMode === 'voters'">
    <!-- Mobile Card View -->
    <div class="mobile-card-view">
      <div class="mobile-card" *ngFor="let voter of filteredVoters">
        <div class="mobile-card-header">
          <div class="mobile-card-title">{{ voter.name }}</div>
          <span class="mobile-card-badge" [style.background]="'#e0f2fe'" [style.color]="'#0c4a6e'">{{ voter.ward }}</span>
        </div>
        <div class="mobile-card-body">
          <div class="mobile-card-row">
            <span class="mobile-card-label">EPIC ID</span>
            <span class="mobile-card-value">{{ voter.epicId }}</span>
          </div>
          <div class="mobile-card-row">
            <span class="mobile-card-label">Age / Gender</span>
            <span class="mobile-card-value">{{ voter.age }} / {{ voter.gender }}</span>
          </div>
          <div class="mobile-card-row">
            <span class="mobile-card-label">Booth</span>
            <span class="mobile-card-value">{{ voter.booth }}</span>
          </div>
          <div class="mobile-card-row">
            <span class="mobile-card-label">Street</span>
            <span class="mobile-card-value">{{ voter.street }}</span>
          </div>
          <div class="mobile-card-row" *ngIf="voter.tags && voter.tags.length > 0">
            <span class="mobile-card-label">Tags</span>
            <div style="display: flex; gap: 4px; flex-wrap: wrap;">
              <mat-chip *ngFor="let tag of voter.tags" style="font-size: 11px;">{{ tag }}</mat-chip>
            </div>
          </div>
          <div class="mobile-card-row">
            <span class="mobile-card-label">Last Visit</span>
            <span class="mobile-card-value">{{ voter.lastVisit || 'Never' }}</span>
          </div>
        </div>
        <div class="mobile-card-actions">
          <button mat-raised-button color="primary" style="flex: 1;">View</button>
          <button mat-icon-button><mat-icon>call</mat-icon></button>
          <button mat-icon-button><mat-icon>more_vert</mat-icon></button>
        </div>
      </div>
    </div>

    <!-- Desktop Table View -->
    <table mat-table [dataSource]="filteredVoters" class="voters-table">
      
      <ng-container matColumnDef="epicId">
        <th mat-header-cell *matHeaderCellDef>EPIC ID</th>
        <td mat-cell *matCellDef="let voter"><strong>{{ voter.epicId }}</strong></td>
      </ng-container>

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let voter">{{ voter.name }}</td>
      </ng-container>

      <ng-container matColumnDef="age">
        <th mat-header-cell *matHeaderCellDef>Age</th>
        <td mat-cell *matCellDef="let voter">{{ voter.age }}</td>
      </ng-container>

      <ng-container matColumnDef="gender">
        <th mat-header-cell *matHeaderCellDef>Gender</th>
        <td mat-cell *matCellDef="let voter">{{ voter.gender }}</td>
      </ng-container>

      <ng-container matColumnDef="ward">
        <th mat-header-cell *matHeaderCellDef>Ward</th>
        <td mat-cell *matCellDef="let voter">
          <span class="ward-badge">{{ voter.ward }}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="booth">
        <th mat-header-cell *matHeaderCellDef>Booth</th>
        <td mat-cell *matCellDef="let voter">{{ voter.booth }}</td>
      </ng-container>

      <ng-container matColumnDef="street">
        <th mat-header-cell *matHeaderCellDef>Street</th>
        <td mat-cell *matCellDef="let voter">{{ voter.street }}</td>
      </ng-container>

      <ng-container matColumnDef="tags">
        <th mat-header-cell *matHeaderCellDef>Tags</th>
        <td mat-cell *matCellDef="let voter">
          <mat-chip *ngFor="let tag of voter.tags" class="tag-chip">{{ tag }}</mat-chip>
        </td>
      </ng-container>

      <ng-container matColumnDef="lastVisit">
        <th mat-header-cell *matHeaderCellDef>Last Visit</th>
        <td mat-cell *matCellDef="let voter">
          <span *ngIf="voter.lastVisit">{{ voter.lastVisit }}</span>
          <span *ngIf="!voter.lastVisit" class="no-visit">Never</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let voter">
          <button mat-icon-button [matMenuTriggerFor]="menu">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="viewVoter(voter)">
              <mat-icon>visibility</mat-icon>
              <span>View Profile</span>
            </button>
            <button mat-menu-item (click)="editVoter(voter)">
              <mat-icon>edit</mat-icon>
              <span>Edit Tags</span>
            </button>
            <button mat-menu-item (click)="addVisit(voter)">
              <mat-icon>add_location</mat-icon>
              <span>Log Visit</span>
            </button>
          </mat-menu>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </mat-card>

  <!-- Families Table -->
  <mat-card class="table-card" *ngIf="viewMode === 'families'">
    <table mat-table [dataSource]="families" class="families-table">
      
      <ng-container matColumnDef="familyName">
        <th mat-header-cell *matHeaderCellDef>Family</th>
        <td mat-cell *matCellDef="let family"><strong>{{ family.familyName }}</strong></td>
      </ng-container>

      <ng-container matColumnDef="address">
        <th mat-header-cell *matHeaderCellDef>Address</th>
        <td mat-cell *matCellDef="let family">{{ family.address }}</td>
      </ng-container>

      <ng-container matColumnDef="ward">
        <th mat-header-cell *matHeaderCellDef>Ward</th>
        <td mat-cell *matCellDef="let family">
          <span class="ward-badge">{{ family.ward }}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="members">
        <th mat-header-cell *matHeaderCellDef>Members</th>
        <td mat-cell *matCellDef="let family">{{ family.members }}</td>
      </ng-container>

      <ng-container matColumnDef="voters">
        <th mat-header-cell *matHeaderCellDef>Voters</th>
        <td mat-cell *matCellDef="let family">{{ family.voters }}</td>
      </ng-container>

      <ng-container matColumnDef="tags">
        <th mat-header-cell *matHeaderCellDef>Tags</th>
        <td mat-cell *matCellDef="let family">
          <mat-chip *ngFor="let tag of family.tags" class="tag-chip">{{ tag }}</mat-chip>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let family">
          <button mat-icon-button>
            <mat-icon>arrow_forward</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="familyColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: familyColumns;"></tr>
    </table>
  </mat-card>
</div>
